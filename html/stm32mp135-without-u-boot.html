<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="author" content="Jakob Kastelic">
<meta name="date" content="11 Sep 2025">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Learn how to boot the STM32MP1 Linux kernel directly with Arm Trusted Firmware (TF-A) in Falcon mode, bypassing U-Boot. Step-by-step instructions to do it manually or with Buildroot integration.">
<link rel="stylesheet" href="style.css">
<title>STM32MP135 Without U-Boot (TF-A Falcon Mode)</title>
</head>
<header class="site-banner">
<div class="logo">
<a href="http://embd.cc"><img src="favicon.ico" alt="logo">embd.cc</a>
</div>
<nav class="site-nav">
<a href="archive">Archive</a>
<a href="about">About</a>
</nav>
</header>
<body>
<div class="article">
<div class="article-topic">Linux</div>
<h2>STM32MP135 Without U-Boot (TF-A Falcon Mode)</h2>
<div class="article-meta">Published 11 Sep 2025, modified 4 Feb 2026. Written by Jakob Kastelic.</div>
<p><img src="../images/red.jpg" alt="" /></p>
<p><em>This is Part 3 in the series: Linux on STM32MP135. <a href="#series-list">See other
articles.</a></em></p>
<p>In this article, we use Arm Trusted Firmware (TF-A) to load the Linux kernel
directly, without using U-Boot.<sup class="footnote-ref"><a href="#2421a621-fn1" id="2421a621-fnref1">[1]</a></sup> I have seen the idea of omitting the
Secondary Program Loader (SPL) referred to as “falcon mode”, since it makes the
boot process (slightly) faster. However, I am primarily interested in it as a
way of reducing overall complexity of the software stack.</p>
<p>In this article, we will implement this in two ways. First, we modify the files
as needed manually. At the end of the article, we provide an alternative method:
directly integrate the changes into Buildroot.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>To get started, make sure to have built the default configuration as per the
<a href="stm32mp135-linux-default-buildroot">first article</a> of this series. Very
briefly, this entails cloning the official Buildroot repository, selecting a
defconfig, and compiling:</p>
<pre><code><div class="codehilite"><pre><span></span>$ git clone https://gitlab.com/buildroot.org/buildroot.git --depth=1
$ cd buildroot
$ make stm32mp135f_dk_defconfig
$ make menuconfig # add the STM32MP_USB_PROGRAMMER=1 flag to TF-A build
$ make
</pre></div>
</code></pre>
<p>It is also recommended to learn how to flash the SD card without removing it via
a USB connection, as explained in the <a href="stm32mp135-linux-cubeprog">second
article</a>.</p>
<h3 id="tutorial">Tutorial</h3>
<p>The procedure is pretty simple. All we need to do is to modify some files,
adjust some build parameters, recompile, and the new SD card image is ready to
test.</p>
<ol>
<li>
<p>Before making any modifications, make a backup of the file containing U-Boot.</p>
<pre><code><div class="codehilite"><pre><span></span>$ cd output/images
$ cp fip.bin fip_uboot.bin
</pre></div>
</code></pre>
<p>Double check that the above <code>fip.bin</code> was built using the additional ATF
build variable <code>STM32MP_USB_PROGRAMMER=1</code>, otherwise USB flashing will not
work!</p>
<p>Open <code>flash.tsv</code>, and update the <code>fip.bin</code> to <code>fip_uboot.bin</code> there as well.</p>
<p>(Despite removing U-Boot from the boot process, we are still going to use it
to flash the SD card image via USB using the STM32CubeProg.)</p>
</li>
<li>
<p>Two TF-A files need to be modified, so navigate to the TF-A build directory:</p>
<pre><code><div class="codehilite"><pre><span></span>$ cd ../build/arm-trusted-firmware-lts-v2.10.5
</pre></div>
</code></pre>
<p>Since the kernel is much bigger than U-Boot, it takes longer to load. We need
to adjust the SD card reading timeout. In <code>drivers/st/mmc/stm32_sdmmc2.c</code>,
find the line</p>
<pre><code><div class="codehilite"><pre><span></span>timeout = timeout_init_us(TIMEOUT_US_1_S);
</pre></div>
</code></pre>
<p>and replace it with</p>
<pre><code><div class="codehilite"><pre><span></span>timeout = timeout_init_us(TIMEOUT_US_1_S * 5);
</pre></div>
</code></pre>
<p>Next, we would like to load the kernel deep enough into the memory space so
that relocation of the compressed image is not necessary. In file
<code>plat/st/stm32mp1/stm32mp1_def.h</code>, find the line</p>
<pre><code><div class="codehilite"><pre><span></span>#define STM32MP_BL33_BASE              STM32MP_DDR_BASE
</pre></div>
</code></pre>
<p>and replace it with</p>
<pre><code><div class="codehilite"><pre><span></span>#define STM32MP_BL33_BASE              (STM32MP_DDR_BASE + U(0x2008000))
</pre></div>
</code></pre>
<p>Finally, in order to allow loading such a big <code>BL33</code> as the kernel image, we
adjust the max size. In the same file, find the line</p>
<pre><code><div class="codehilite"><pre><span></span>#define STM32MP_BL33_MAX_SIZE          U(0x400000)
</pre></div>
</code></pre>
<p>and replace it with</p>
<pre><code><div class="codehilite"><pre><span></span>#define STM32MP_BL33_MAX_SIZE          U(0x3FF8000)
</pre></div>
</code></pre>
</li>
<li>
<p>Next, we need to modify a couple build parameters. Open the <code>make menuconfig</code>
and navigate to <code>Bootloaders ---&gt; ARM Trusted Firmware (ATF)</code>.</p>
<ul>
<li>
<p>Under <code>BL33</code>, change from U-Boot to None.</p>
</li>
<li>
<p>Under <code>Additional ATF build variables</code>, make sure that U-Boot is not
present and add the following key-value pairs:</p>
<pre><code><div class="codehilite"><pre><span></span>BL33=$(BINARIES_DIR)/zImage BL33_CFG=$(BINARIES_DIR)/stm32mp135f-dk.dtb
</pre></div>
</code></pre>
</li>
</ul>
<p>Select “Ok” and “Esc” out of the menus, making sure to save the new
configuration.</p>
<p>Next, open the file
<code>board/stmicroelectronics/common/stm32mp1xx/genimage.cfg.template</code> and
increase the size of the <code>fip</code> partition, for example:</p>
<pre><code><div class="codehilite"><pre><span></span>partition fip {
	image = &quot;fip.bin&quot;
	size = 8M
}
</pre></div>
</code></pre>
<p>Finally, since U-Boot will no longer be around to pass the Linux command line
arguments, we can instead pass them through the device tree source. Open the
file <code>output/build/linux-6.12.22/arch/arm/boot/dts/st/stm32mp135f-dk.dts</code>
(you may have a different Linux version, just modify the path as appropriate)
and add the <code>bootargs</code> into the <code>chosen</code> section, as follows:</p>
<pre><code><div class="codehilite"><pre><span></span>chosen {
	stdout-path = &quot;serial0:115200n8&quot;;
	bootargs = &quot;root=/dev/mmcblk0p4 rootwait&quot;;
};
</pre></div>
</code></pre>
</li>
<li>
<p>Now we can rebuild the TF-A, the device tree blob, and regenerate the SD card
image. Thanks to the magic of Buildroot, all it takes is:</p>
<pre><code><div class="codehilite"><pre><span></span>$ make linux-rebuild
$ make arm-trusted-firmware-rebuild
$ make
</pre></div>
</code></pre>
<p>Keep in mind that rebuilding TF-A is needed any time the Linux kernel or DTS
or TF-A sources change, since the kernel gets packaged into the <code>fip</code> by the
TF-A build process. In this case, the first <code>make</code> rebuilds the DTB, the
second packages it in the <code>fip</code>, and the third makes sure it gets into the SD
card.</p>
</li>
<li>
<p>Set DIP switch to serial boot (press in the upper all of all rockers) and
flash to SD card:</p>
<pre><code><div class="codehilite"><pre><span></span>$ sudo ~/cube/bin/STM32_Programmer_CLI -c port=usb1 -w output/images/flash.tsv
</pre></div>
</code></pre>
<p>Then reconfigure the DIP switches for SD card boot (press the bottom side of
the second rocker switch from the left), and press the black reboot button.</p>
</li>
</ol>
<p>If you watch the serial monitor carefully, you will notice that we transition
from TF-A directly to OP-TEE and Linux. Success! No U-Boot in the boot process:</p>
<pre><code><div class="codehilite"><pre><span></span>NOTICE:  Model: STMicroelectronics STM32MP135F-DK Discovery Board
NOTICE:  Board: MB1635 Var1.0 Rev.E-02
NOTICE:  BL2: v2.10.5(release):lts-v2.10.5
NOTICE:  BL2: Built : 20:58:52, Sep 10 2025
NOTICE:  BL2: Booting BL32
I/TC: Early console on UART#4
I/TC: 
I/TC: Embedded DTB found
I/TC: OP-TEE version: Unknown_4.3 (gcc version 14.3.0 (Buildroot 2025.08-rc3-87-gbbb0164de0)) #1 Thu Sep  4 03:06:46 UTC 2025 arm
...
(more OP-TEE messages here)
...
[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 6.12.22 (jk@Lutien) (arm-buildroot-linux-gnueabihf-gcc.br_real (Buildroot 2025.08-rc3-87-gbbb0164de0) 14.3.0, GNU ld (GNU Binutils) 2.43.1) #1 SMP PREEMPT Wed Sep  3 20:23:46 PDT 2025
[    0.000000] CPU: ARMv7 Processor [410fc075] revision 5 (ARMv7), cr=10c5387d
</pre></div>
</code></pre>
<h3 id="buildroot-integration">Buildroot integration</h3>
<p>Instead of following the above instructions, we can automate the build process
by integrating it into Buildroot. To this end, I provide the GitHub repository
<a href="https://github.com/js216/stm32mp135_simple"><code>stm32mp135_simple</code></a> that can be
used as follows.</p>
<p>Clone the Buildroot repository. To make the procedure reproducible, let’s start
from a fixed commit (latest at the time of this writing):</p>
<pre><code><div class="codehilite"><pre><span></span>$ git clone https://gitlab.com/buildroot.org/buildroot.git
$ cd buildroot
$ git checkout 5b6b80bfc5237ab4f4e35c081fdac1376efdd396
</pre></div>
</code></pre>
<p>Obtain this repository with the patches we need. Copy the defconfig and the
board-specific files into the Buildroot tree.</p>
<pre><code><div class="codehilite"><pre><span></span>$ git clone git@github.com:js216/stm32mp135_simple.git
$ cd buildroot # NOT stm32mp135_simple
$ git apply ../stm32mp135_simple/patches/add_falcon.patch
$ git apply ../stm32mp135_simple/patches/increase_fip.patch
$ cp ../configs/stm32mp135_simple/stm32mp135f_dk_falcon_defconfig configs
$ cp -r ../board/stm32mp135_simple/stm32mp135f-dk-falcon board/stmicroelectronics
</pre></div>
</code></pre>
<p>Build as usual, but using the new defconfig:</p>
<pre><code><div class="codehilite"><pre><span></span>$ make stm32mp135f_dk_falcon_defconfig
$ make
</pre></div>
</code></pre>
<p>Flash to the SD card and boot into the new system. You should reach the login
prompt exactly as in the default configuration—but without involving U-Boot</p>
<h3 id="discussion">Discussion</h3>
<p>To port the “default” STM32MP135 setup<sup class="footnote-ref"><a href="#2421a621-fn2" id="2421a621-fnref2">[2]</a></sup> to a new board design, one is
expected to be comfortable writing and modifying the drivers and device tree
sources that work with</p>
<ul>
<li>Arm Trusted Firmware (Primary Program Loader)</li>
<li>OP-TEE (Trusted Execution Environment)</li>
<li>U-Boot (Secondary Program Loader)</li>
<li>Linux kernel</li>
<li>Buildroot, or, worse, Yocto</li>
</ul>
<p>That is a tall order for a new embedded developer trying to get started
integrating Linux in their products. To make things worse, there is at present
almost no literature to be found suggesting that a simpler, saner method exists.
Certainly the chip vendors themselves do not encourage it.<sup class="footnote-ref"><a href="#2421a621-fn3" id="2421a621-fnref3">[3]</a></sup></p>
<p>With this article, we have began chipping away at the unnecessary complexity. We
have removed U-Boot from the boot chain. (We still use it for copying the SD
card image via USB. One thing at a time!) Since our goal is to <em>run Linux</em>, the
list above gives us a blueprint for the work that remains to be done: get rid of
everything that is <em>not Linux</em>.</p>
<p>The software that you do not run is software you do not have to understand,
test, debug, maintain, and be responsible for when it breaks down ten years down
the line in some deeply embedded application, perhaps in outer space.</p>
<h3 id="upstreaming-status">Upstreaming Status</h3>
<p>19/12/2024: original Buildroot mailing list submission <a href="https://lists.buildroot.org/pipermail/buildroot/2024-December/769250.html">(1/1)</a></p>
<p>16/12/2025: response by Arnout Vandecappelle <a href="https://lists.buildroot.org/pipermail/buildroot/2025-May/778563.html">(link)</a></p>
<p>17/9/2025: amended submission <a href="https://lists.buildroot.org/pipermail/buildroot/2025-September/786595.html">(v2 0/2, </a>
<a href="https://lists.buildroot.org/pipermail/buildroot/2025-September/786596.html">1/2, </a>
<a href="https://lists.buildroot.org/pipermail/buildroot/2025-September/786597.html">2/2)</a></p>
<p>02/04/2026: merged by Thomas Petazzoni as Buildroot commit
<a href="https://gitlab.com/buildroot.org/buildroot/-/commit/8e4c663529d135088c78a9c7f4b59354f19d6580"><code>8e4c663529d135088c78a9c7f4b59354f19d6580</code></a></p>
<div class="series-box">
<h3 id="series-list">All Articles in This Series</h3>
<ul>
  <li><a href="stm32mp135-linux-default-buildroot">1. STM32MP135 Default Buildroot Configuration</a></li>
  <li><a href="stm32mp135-linux-cubeprog">2. STM32MP135 Flashing via USB with STM32CubeProg</a></li>
  <li><em>3. This article</em></li>
  <li><a href="linux-tfa-bl33-qemu">4. Linux as TF-A BL33 on Qemu (No U-Boot)</a></li>
  <li><a href="stm32mp135-without-optee">5. STM32MP135 Without OP-TEE</a></li>
  <li><a href="linux-bringup-on-custom-stm32mp135-board">6. Linux Bring-Up on a Custom STM32MP135 Board</a></li>
  <li><a href="build-linux-for-stm32mp135-in-under-50-lines-of-makefile">7. Build Linux for STM32MP135 in under 50 Lines of Makefile</a></li>
</ul>
</div>
<hr class="footnotes-sep" />
<section class="footnotes">
<ol class="footnotes-list">
<li id="2421a621-fn1" class="footnote-item"><p>This approach is inspired by the ST wiki article <a href="https://wiki.st.com/stm32mpu/wiki/How_to_optimize_the_boot_time">How to optimize the
boot time</a>,
under “Optimizing boot-time by removing U-Boot”. (cited 09/11/2025) <a href="#2421a621-fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="2421a621-fn2" class="footnote-item"><p>See the ST Wiki, <a href="https://wiki.st.com/stm32mpu/wiki/OpenSTLinux_distribution">OpenSTLinux
distribution</a>
(cited 09/11/2025) <a href="#2421a621-fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="2421a621-fn3" class="footnote-item"><p>As per the <a href="https://community.st.com/t5/stm32-mpus-embedded-software-and/start-linux-kernel-from-tf-a/td-p/91321">ST
forum,</a>
(cited 09/11/2025) the approach outlined in the present article is
officially <em>not</em> supported by ST. <a href="#2421a621-fnref3" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

</div>

<footer class="license-footer">
<p>Content licensed under
<a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.
</p>
</footer>

</body>
</html>
